#!/usr/bin/env node
const util=require("./utils"),path=require("path"),print=require("./print"),open=require("open"),fs=require("fs"),chalk=require("chalk"),CachePath=path.join(__dirname,"..",".cache/note");async function fetchSync(){fs.existsSync(CachePath)||await exports.RemoteFetch()}const WEBSITE_KEY="websit";exports.SyncConfig=async function(){const{ok:e}=await util.GetConfig(WEBSITE_KEY);if(!e){const{ok:e,msg:i,data:s}=await util.Inquirer([{type:"input",message:"请输入git仓库托管地址",default:"https://gitee.com",name:"git_url"},{type:"input",message:"owner(作者)",name:"owner",default:"gjwork"},{type:"input",message:"name(项目名)",name:"name",default:"note"},{type:"input",message:"branch(分支)",name:"branch",default:"master"}]);e||(print.Error(i),process.exit(1));var{git_url:t,owner:n,name:r,branch:a}=s,{ok:r,msg:a}=await util.SetConfig({[WEBSITE_KEY]:`${t}:${n}/${r}#${a}`});r||(print.Error(a),process.exit(1))}},exports.RemoteFetch=async function(){var{ok:e,data:t,msg:n}=await util.GetConfig(WEBSITE_KEY);return e||(print.Error(n),process.exit(1)),util.DownloadTemplate(t,CachePath,!0)},exports.ShowAll=async function(){await fetchSync();const e=require(`${CachePath}/websit.js`);var t=(e||[]).map(e=>{const{keywords:t,url:n,description:r}=e||{};return`${r} [${(t||[]).join()}] ${chalk.green(n)}\n`});print.Messages(t)},exports.Open=async function(t){await fetchSync();var n=require(`${CachePath}/websit.js`);const r=[];for(let e=0;e<n.length;e++){const{keywords:i=[]}=n[e];i.includes(t)&&r.push(n[e])}var e,a=r.length;return 0===a?print.Error("关键词不存在"):1===a?open(r[0].url):void(1<a&&({ok:e,data:a}=await util.Inquirer([{type:"list",message:"链接",name:"url",choices:r.map(e=>e.url)}]),e&&open(a.url)))};