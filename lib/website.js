#!/usr/bin/env node
const util=require("./utils"),path=require("path"),print=require("./print"),open=require("open"),fs=require("fs"),chalk=require("chalk"),CachePath=path.join(__dirname,"..",".cache/note");async function fetchSync(){fs.existsSync(CachePath)||await exports.RemoteFetch()}exports.RemoteFetch=function(){return util.DownloadTemplate("https://gitee.com:gjwork/note#master",CachePath,!0)},exports.ShowAll=async function(){await fetchSync();const e=require(`${CachePath}/websit.js`);var t=(e||[]).map(e=>{const{keywords:t,url:r,description:n}=e||{};return`${n} [${(t||[]).join()}] ${chalk.green(r)}\n`});print.Messages(t)},exports.Open=async function(t){await fetchSync();var r=require(`${CachePath}/websit.js`);const n=[];for(let e=0;e<r.length;e++){const{keywords:i=[]}=r[e];i.includes(t)&&n.push(r[e])}var e,a=n.length;return 0===a?print.Error("关键词不存在"):1===a?open(n[0].url):void(1<a&&({ok:e,data:a}=await util.Inquirer([{type:"list",message:"链接",name:"url",choices:n.map(e=>e.url)}]),e&&open(a.url)))};